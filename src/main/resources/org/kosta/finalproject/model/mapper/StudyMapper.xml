<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.kosta.finalproject.model.mapper.StudyMapper">
    <resultMap id="studyStateDTOMap" type="StudyStateDTO">
        <id property="studyState" column="study_state"/>
    </resultMap>
    <resultMap id="categoryTypeDTOMap" type="CategoryTypeDTO">
        <id property="categoryType" column="category_type"/>
    </resultMap>
    <resultMap id="categoryLangDTOMap" type="CategoryLangDTO">
        <id property="categoryLang" column="category_lang"/>
    </resultMap>
    <resultMap id="studyDTOMap" type="StudyDTO">
        <id property="studyNo" column="study_no"/>
        <id property="studyName" column="study_name"/>
        <id property="studyDesc" column="study_desc"/>
        <id property="studyRegDate" column="study_regdate"/>
    </resultMap>
    <resultMap id="memberDTOMap" type="MemberDTO">
        <id property="name" column="name"/>
        <id property="picture" column="picture"/>
    </resultMap>
    <resultMap id="studyMemberDTOMap" type="StudyMemberDTO">
        <collection property="memberDTO" resultMap="memberDTOMap"/>
        <collection property="studyDTO" resultMap="studyDTOMap">
            <collection property="studyStateDTO" resultMap="studyStateDTOMap"/>
            <collection property="categoryTypeDTO" resultMap="categoryTypeDTOMap"/>
            <collection property="categoryLangDTO" resultMap="categoryLangDTOMap"/>
        </collection>
    </resultMap>

    <select id="getStudyList3" resultMap="studyMemberDTOMap">
        select m.name,
        m.PICTURE,
        s.STUDY_NO,
        s.STUDY_NAME,
        s.STUDY_DESC,
        s.STUDY_REGDATE,
        stt.STUDY_STATE,
        ctt.category_type,
        clt.category_lang
        from member m,
        STUDY_MEMBER sm,
        STUDY s,
        STUDY_STATE_TABLE stt,
        category_type_table ctt,
        category_lang_table clt
        where m.EMAIL = sm.EMAIL
        and s.STUDY_NO = sm.STUDY_NO
        and s.STUDY_STATE_CODE = stt.STUDY_STATE_CODE
        and s.category_lang_no = clt.category_lang_no
        and s.category_type_no = ctt.category_type_no
        and <![CDATA[ROWNUM <= 3]]>
        order by s.STUDY_NO desc
    </select>
</mapper>